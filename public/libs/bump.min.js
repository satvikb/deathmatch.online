"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Bump=function(){function a(){var b=arguments.length<=0||void 0===arguments[0]?PIXI:arguments[0];if(_classCallCheck(this,a),void 0===b)throw new Error("Please assign a rendering engine in the constructor before using bump.js");this.renderer="pixi"}return _createClass(a,[{key:"addCollisionProperties",value:function(b){"pixi"===this.renderer&&(void 0===b.gx&&Object.defineProperty(b,"gx",{get:function(){return b.getGlobalPosition().x},enumerable:!0,configurable:!0}),void 0===b.gy&&Object.defineProperty(b,"gy",{get:function(){return b.getGlobalPosition().y},enumerable:!0,configurable:!0}),void 0===b.centerX&&Object.defineProperty(b,"centerX",{get:function(){return b.x+b.width/2},enumerable:!0,configurable:!0}),void 0===b.centerY&&Object.defineProperty(b,"centerY",{get:function(){return b.y+b.height/2},enumerable:!0,configurable:!0}),void 0===b.halfWidth&&Object.defineProperty(b,"halfWidth",{get:function(){return b.width/2},enumerable:!0,configurable:!0}),void 0===b.halfHeight&&Object.defineProperty(b,"halfHeight",{get:function(){return b.height/2},enumerable:!0,configurable:!0}),void 0===b.xAnchorOffset&&Object.defineProperty(b,"xAnchorOffset",{get:function(){return void 0!==b.anchor?b.width*b.anchor.x:0},enumerable:!0,configurable:!0}),void 0===b.yAnchorOffset&&Object.defineProperty(b,"yAnchorOffset",{get:function(){return void 0!==b.anchor?b.height*b.anchor.y:0},enumerable:!0,configurable:!0}),b.circular&&void 0===b.radius&&Object.defineProperty(b,"radius",{get:function(){return b.width/2},enumerable:!0,configurable:!0})),b._bumpPropertiesAdded=!0}},{key:"hitTestPoint",value:function(b,c){c._bumpPropertiesAdded||this.addCollisionProperties(c);var d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,l=void 0;if(d=c.radius?"circle":"rectangle","rectangle"===d&&(e=c.x-c.xAnchorOffset,f=c.x+c.width-c.xAnchorOffset,g=c.y-c.yAnchorOffset,h=c.y+c.height-c.yAnchorOffset,l=b.x>e&&b.x<f&&b.y>g&&b.y<h),"circle"===d){var m=b.x-c.x-c.width/2+c.xAnchorOffset,n=b.y-c.y-c.height/2+c.yAnchorOffset,o=Math.sqrt(m*m+n*n);l=o<c.radius}return l}},{key:"hitTestCircle",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);var e=void 0,f=void 0,g=void 0,h=void 0,i=void 0;return d?(e=c.gx+c.width/2-c.xAnchorOffset-(b.gx+b.width/2-b.xAnchorOffset),f=c.gy+c.width/2-c.yAnchorOffset-(b.gy+b.width/2-b.yAnchorOffset)):(e=c.x+c.width/2-c.xAnchorOffset-(b.x+b.width/2-b.xAnchorOffset),f=c.y+c.width/2-c.yAnchorOffset-(b.y+b.width/2-b.yAnchorOffset)),g=Math.sqrt(e*e+f*f),h=b.radius+c.radius,i=g<h}},{key:"circleCollision",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);var f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m={},n=!1;if(e?(i=c.gx+c.width/2-c.xAnchorOffset-(b.gx+b.width/2-b.xAnchorOffset),j=c.gy+c.width/2-c.yAnchorOffset-(b.gy+b.width/2-b.yAnchorOffset)):(i=c.x+c.width/2-c.xAnchorOffset-(b.x+b.width/2-b.xAnchorOffset),j=c.y+c.width/2-c.yAnchorOffset-(b.y+b.width/2-b.yAnchorOffset)),f=Math.sqrt(i*i+j*j),g=b.radius+c.radius,f<g){n=!0,h=g-f;var o=.3;h+=o,k=i/f,l=j/f,b.x-=h*k,b.y-=h*l,d&&(m.x=j,m.y=-i,this.bounceOffSurface(b,m))}return n}},{key:"movingCircleCollision",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);var e=void 0,f=void 0,g=void 0,h=void 0,i={},j={},k={},l={},m={},n=!1;if(b.mass=b.mass||1,c.mass=c.mass||1,d?(i.vx=c.gx+c.radius-c.xAnchorOffset-(b.gx+b.radius-b.xAnchorOffset),i.vy=c.gy+c.radius-c.yAnchorOffset-(b.gy+b.radius-b.yAnchorOffset)):(i.vx=c.x+c.radius-c.xAnchorOffset-(b.x+b.radius-b.xAnchorOffset),i.vy=c.y+c.radius-c.yAnchorOffset-(b.y+b.radius-b.yAnchorOffset)),i.magnitude=Math.sqrt(i.vx*i.vx+i.vy*i.vy),e=b.radius+c.radius,i.magnitude<e){n=!0,f=e-i.magnitude,f+=.3,i.dx=i.vx/i.magnitude,i.dy=i.vy/i.magnitude,i.vxHalf=Math.abs(i.dx*f/2),i.vyHalf=Math.abs(i.dy*f/2),g=b.x>c.x?1:-1,h=b.y>c.y?1:-1,b.x=b.x+i.vxHalf*g,b.y=b.y+i.vyHalf*h,c.x=c.x+i.vxHalf*-g,c.y=c.y+i.vyHalf*-h,i.lx=i.vy,i.ly=-i.vx;var o=b.vx*i.dx+b.vy*i.dy;j.x=o*i.dx,j.y=o*i.dy;var p=b.vx*(i.lx/i.magnitude)+b.vy*(i.ly/i.magnitude);k.x=p*(i.lx/i.magnitude),k.y=p*(i.ly/i.magnitude);var q=c.vx*i.dx+c.vy*i.dy;l.x=q*i.dx,l.y=q*i.dy;var r=c.vx*(i.lx/i.magnitude)+c.vy*(i.ly/i.magnitude);m.x=r*(i.lx/i.magnitude),m.y=r*(i.ly/i.magnitude),b.bounce={},b.bounce.x=k.x+l.x,b.bounce.y=k.y+l.y,c.bounce={},c.bounce.x=j.x+m.x,c.bounce.y=j.y+m.y,b.vx=b.bounce.x/b.mass,b.vy=b.bounce.y/b.mass,c.vx=c.bounce.x/c.mass,c.vy=c.bounce.y/c.mass}return n}},{key:"multipleCircleCollision",value:function(b){for(var c=!(arguments.length<=1||void 0===arguments[1])&&arguments[1],d=0;d<b.length;d++)for(var e=b[d],f=d+1;f<b.length;f++){var g=b[f];this.movingCircleCollision(e,g,c)}}},{key:"rectangleCollision",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=arguments.length<=3||void 0===arguments[3]||arguments[3];b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);var f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;return e?(k=b.gx+b.halfWidth-b.xAnchorOffset-(c.gx+c.halfWidth-c.xAnchorOffset),l=b.gy+b.halfHeight-b.yAnchorOffset-(c.gy+c.halfHeight-c.yAnchorOffset)):(k=b.x+b.halfWidth-b.xAnchorOffset-(c.x+c.halfWidth-c.xAnchorOffset),l=b.y+b.halfHeight-b.yAnchorOffset-(c.y+c.halfHeight-c.yAnchorOffset)),g=b.halfWidth+c.halfWidth,h=b.halfHeight+c.halfHeight,Math.abs(k)<g&&Math.abs(l)<h&&(i=g-Math.abs(k),j=h-Math.abs(l),i>=j?(l>0?(f="top",b.y=b.y+j):(f="bottom",b.y=b.y-j),d&&(b.vy*=-1)):(k>0?(f="left",b.x=b.x+i):(f="right",b.x=b.x-i),d&&(b.vx*=-1))),f}},{key:"hitTestRectangle",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);var e=void 0,f=void 0,g=void 0,h=void 0,i=void 0;return e=!1,d?(h=b.gx+b.halfWidth-b.xAnchorOffset-(c.gx+c.halfWidth-c.xAnchorOffset),i=b.gy+b.halfHeight-b.yAnchorOffset-(c.gy+c.halfHeight-c.yAnchorOffset)):(h=b.x+b.halfWidth-b.xAnchorOffset-(c.x+c.halfWidth-c.xAnchorOffset),i=b.y+b.halfHeight-b.yAnchorOffset-(c.y+c.halfHeight-c.yAnchorOffset)),f=b.halfWidth+c.halfWidth,g=b.halfHeight+c.halfHeight,e=Math.abs(h)<f&&Math.abs(i)<g}},{key:"hitTestCircleRectangle",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];c._bumpPropertiesAdded||this.addCollisionProperties(c),b._bumpPropertiesAdded||this.addCollisionProperties(b);var e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;if(d?(g=b.gx,h=b.gy,i=c.gx,j=c.gy):(g=b.x,h=b.y,i=c.x,j=c.y),e=h-b.yAnchorOffset<j-c.halfHeight-c.yAnchorOffset?g-b.xAnchorOffset<i-1-c.halfWidth-c.xAnchorOffset?"topLeft":g-b.xAnchorOffset>i+1+c.halfWidth-c.xAnchorOffset?"topRight":"topMiddle":h-b.yAnchorOffset>j+c.halfHeight-c.yAnchorOffset?g-b.xAnchorOffset<i-1-c.halfWidth-c.xAnchorOffset?"bottomLeft":g-b.xAnchorOffset>i+1+c.halfWidth-c.xAnchorOffset?"bottomRight":"bottomMiddle":g-b.xAnchorOffset<i-c.halfWidth-c.xAnchorOffset?"leftMiddle":"rightMiddle","topMiddle"===e||"bottomMiddle"===e||"leftMiddle"===e||"rightMiddle"===e)f=this.hitTestRectangle(b,c,d);else{var k={};switch(e){case"topLeft":k.x=i-c.xAnchorOffset,k.y=j-c.yAnchorOffset;break;case"topRight":k.x=i+c.width-c.xAnchorOffset,k.y=j-c.yAnchorOffset;break;case"bottomLeft":k.x=i-c.xAnchorOffset,k.y=j+c.height-c.yAnchorOffset;break;case"bottomRight":k.x=i+c.width-c.xAnchorOffset,k.y=j+c.height-c.yAnchorOffset}f=this.hitTestCirclePoint(b,k,d)}return f?e:f}},{key:"hitTestCirclePoint",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2];return b._bumpPropertiesAdded||this.addCollisionProperties(b),c.diameter=1,c.width=c.diameter,c.radius=.5,c.centerX=c.x,c.centerY=c.y,c.gx=c.x,c.gy=c.y,c.xAnchorOffset=0,c.yAnchorOffset=0,c._bumpPropertiesAdded=!0,this.hitTestCircle(b,c,d)}},{key:"circleRectangleCollision",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];c._bumpPropertiesAdded||this.addCollisionProperties(c),b._bumpPropertiesAdded||this.addCollisionProperties(b);var f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0;if(e?(h=b.gx,i=b.gy,j=c.gx,k=c.gy):(h=b.x,i=b.y,j=c.x,k=c.y),f=i-b.yAnchorOffset<k-c.halfHeight-c.yAnchorOffset?h-b.xAnchorOffset<j-1-c.halfWidth-c.xAnchorOffset?"topLeft":h-b.xAnchorOffset>j+1+c.halfWidth-c.xAnchorOffset?"topRight":"topMiddle":i-b.yAnchorOffset>k+c.halfHeight-c.yAnchorOffset?h-b.xAnchorOffset<j-1-c.halfWidth-c.xAnchorOffset?"bottomLeft":h-b.xAnchorOffset>j+1+c.halfWidth-c.xAnchorOffset?"bottomRight":"bottomMiddle":h-b.xAnchorOffset<j-c.halfWidth-c.xAnchorOffset?"leftMiddle":"rightMiddle","topMiddle"===f||"bottomMiddle"===f||"leftMiddle"===f||"rightMiddle"===f)g=this.rectangleCollision(b,c,d,e);else{var l={};switch(f){case"topLeft":l.x=j-c.xAnchorOffset,l.y=k-c.yAnchorOffset;break;case"topRight":l.x=j+c.width-c.xAnchorOffset,l.y=k-c.yAnchorOffset;break;case"bottomLeft":l.x=j-c.xAnchorOffset,l.y=k+c.height-c.yAnchorOffset;break;case"bottomRight":l.x=j+c.width-c.xAnchorOffset,l.y=k+c.height-c.yAnchorOffset}g=this.circlePointCollision(b,l,d,e)}return g?f:g}},{key:"circlePointCollision",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=!(arguments.length<=3||void 0===arguments[3])&&arguments[3];return b._bumpPropertiesAdded||this.addCollisionProperties(b),c.diameter=1,c.width=c.diameter,c.radius=.5,c.centerX=c.x,c.centerY=c.y,c.gx=c.x,c.gy=c.y,c.xAnchorOffset=0,c.yAnchorOffset=0,c._bumpPropertiesAdded=!0,this.circleCollision(b,c,d,e)}},{key:"bounceOffSurface",value:function(b,c){b._bumpPropertiesAdded||this.addCollisionProperties(b);var d=void 0,e=void 0,f={},g={},h={},i=b.mass||1;c.lx=c.y,c.ly=-c.x,c.magnitude=Math.sqrt(c.x*c.x+c.y*c.y),c.dx=c.x/c.magnitude,c.dy=c.y/c.magnitude,d=b.vx*c.dx+b.vy*c.dy,f.vx=d*c.dx,f.vy=d*c.dy,e=b.vx*(c.lx/c.magnitude)+b.vy*(c.ly/c.magnitude),g.vx=e*(c.lx/c.magnitude),g.vy=e*(c.ly/c.magnitude),g.vx*=-1,g.vy*=-1,h.x=f.vx+g.vx,h.y=f.vy+g.vy,b.vx=h.x/i,b.vy=h.y/i}},{key:"contain",value:function(b,c){var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3];b._bumpPropertiesAdded||this.addCollisionProperties(b),void 0===c.xAnchorOffset&&(c.xAnchorOffset=0),void 0===c.yAnchorOffset&&(c.yAnchorOffset=0),void 0===b.parent.gx&&(b.parent.gx=0),void 0===b.parent.gy&&(b.parent.gy=0);var f=new Set;return b.x-b.xAnchorOffset<c.x-b.parent.gx-c.xAnchorOffset&&(d&&(b.vx*=-1),b.mass&&(b.vx/=b.mass),b.x=c.x-b.parent.gx-c.xAnchorOffset+b.xAnchorOffset,f.add("left")),b.y-b.yAnchorOffset<c.y-b.parent.gy-c.yAnchorOffset&&(d&&(b.vy*=-1),b.mass&&(b.vy/=b.mass),b.y=c.y-b.parent.gy-c.yAnchorOffset+b.yAnchorOffset,f.add("top")),b.x-b.xAnchorOffset+b.width>c.width-c.xAnchorOffset&&(d&&(b.vx*=-1),b.mass&&(b.vx/=b.mass),b.x=c.width-b.width-c.xAnchorOffset+b.xAnchorOffset,f.add("right")),b.y-b.yAnchorOffset+b.height>c.height-c.yAnchorOffset&&(d&&(b.vy*=-1),b.mass&&(b.vy/=b.mass),b.y=c.height-b.height-c.yAnchorOffset+b.yAnchorOffset,f.add("bottom")),0===f.size&&(f=void 0),f&&e&&e(f),f}},{key:"outsideBounds",value:function(b,c,d){var e=c.x,f=c.y,g=c.width,h=c.height,i=new Set;return b.x<e-b.width&&i.add("left"),b.y<f-b.height&&i.add("top"),b.x>g+b.width&&i.add("right"),b.y>h+b.height&&i.add("bottom"),0===i.size&&(i=void 0),i&&d&&d(i),i}},{key:"_getCenter",value:function(b,c,d){return void 0!==b.anchor?0!==b.anchor[d]?0:c/2:c}},{key:"hit",value:function(b,c){function s(a,b){var c=void 0!==a.parent,d=void 0!==b.parent;if(c&&d)return a.diameter&&b.diameter?u(a,b):a.diameter&&!b.diameter?w(a,b):v(a,b);if(d&&void 0!==a.x&&void 0!==a.y)return h(a,b);throw new Error("I'm sorry, "+a+" and "+b+" cannot be use together in a collision test.'")}function t(){if(b instanceof Array)var a=[e,d],d=a[0],e=a[1];for(var f=c.length-1;f>=0;f--){var h=c[f];p=s(b,h),p&&g&&g(p,h)}}function u(a,b){return d?a.vx+a.vy!==0&&b.vx+b.vy!==0?k(a,b,f):l(a,b,e,f):j(a,b)}function v(a,b){return d?n(a,b,e,f):i(a,b,f)}function w(a,b){return d?o(a,b,e,f):m(a,b,f)}var d=!(arguments.length<=2||void 0===arguments[2])&&arguments[2],e=!(arguments.length<=3||void 0===arguments[3])&&arguments[3],f=arguments[4],g=arguments.length<=5||void 0===arguments[5]?void 0:arguments[5],h=this.hitTestPoint.bind(this),i=this.hitTestRectangle.bind(this),j=this.hitTestCircle.bind(this),k=this.movingCircleCollision.bind(this),l=this.circleCollision.bind(this),m=this.hitTestCircleRectangle.bind(this),n=this.rectangleCollision.bind(this),o=this.circleRectangleCollision.bind(this),p=void 0,q=void 0!==b.parent,r=void 0!==c.parent;return q&&c instanceof Array||r&&b instanceof Array?t():(p=s(b,c),p&&g&&g(p)),p}}]),a}();